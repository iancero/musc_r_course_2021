<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Logistic Regression | An Organic R Textbook</title>
  <meta name="description" content="This is the organic textbook accompanying Cero’s 2021 course on statistical programming with R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Logistic Regression | An Organic R Textbook" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://iancero.github.io/musc_r_course_2021" />
  
  <meta property="og:description" content="This is the organic textbook accompanying Cero’s 2021 course on statistical programming with R" />
  <meta name="github-repo" content="iancero/musc_r_course_2021" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Logistic Regression | An Organic R Textbook" />
  
  <meta name="twitter:description" content="This is the organic textbook accompanying Cero’s 2021 course on statistical programming with R" />
  

<meta name="author" content="Ian Cero, PhD MStat" />


<meta name="date" content="2021-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="basic-r.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#overview-of-the-r-ecosystem"><i class="fa fa-check"></i><b>2.1</b> Overview of the R ecosystem</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#installation"><i class="fa fa-check"></i><b>2.2</b> Installation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started.html"><a href="getting-started.html#step-1---download-and-install-the-r-language"><i class="fa fa-check"></i><b>2.2.1</b> Step 1 - Download and install the R language</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started.html"><a href="getting-started.html#step-2---download-and-install-the-rstudio-ide"><i class="fa fa-check"></i><b>2.2.2</b> Step 2 - Download and install the RStudio IDE</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started.html"><a href="getting-started.html#step-3---install-the-tidyverse-package-optional"><i class="fa fa-check"></i><b>2.2.3</b> Step 3 - Install the <code>tidyverse</code> package (optional)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#a-tour-of-rstudio"><i class="fa fa-check"></i><b>2.3</b> A tour of RStudio</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="getting-started.html"><a href="getting-started.html#the-console"><i class="fa fa-check"></i><b>2.3.1</b> The console</a></li>
<li class="chapter" data-level="2.3.2" data-path="getting-started.html"><a href="getting-started.html#the-environment"><i class="fa fa-check"></i><b>2.3.2</b> The environment</a></li>
<li class="chapter" data-level="2.3.3" data-path="getting-started.html"><a href="getting-started.html#the-lower-right-pane"><i class="fa fa-check"></i><b>2.3.3</b> The lower right pane</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="getting-started.html"><a href="getting-started.html#your-very-first-analysis"><i class="fa fa-check"></i><b>2.4</b> Your very first analysis</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="getting-started.html"><a href="getting-started.html#step-1---download-the-data"><i class="fa fa-check"></i><b>2.4.1</b> Step 1 - download the data</a></li>
<li class="chapter" data-level="2.4.2" data-path="getting-started.html"><a href="getting-started.html#step-2---make-an-rstudio-project"><i class="fa fa-check"></i><b>2.4.2</b> Step 2 - Make an RStudio Project</a></li>
<li class="chapter" data-level="2.4.3" data-path="getting-started.html"><a href="getting-started.html#step-3---get-the-data-into-your-project-folder"><i class="fa fa-check"></i><b>2.4.3</b> Step 3 - Get the data into your project folder</a></li>
<li class="chapter" data-level="2.4.4" data-path="getting-started.html"><a href="getting-started.html#step-4---open-an-rmarkdown-notebook"><i class="fa fa-check"></i><b>2.4.4</b> Step 4 - Open an Rmarkdown Notebook</a></li>
<li class="chapter" data-level="2.4.5" data-path="getting-started.html"><a href="getting-started.html#step-5---create-a-space-to-code"><i class="fa fa-check"></i><b>2.4.5</b> Step 5 - Create a space to code</a></li>
<li class="chapter" data-level="2.4.6" data-path="getting-started.html"><a href="getting-started.html#step-6---write-a-command-to-import-the-data"><i class="fa fa-check"></i><b>2.4.6</b> Step 6 - Write a command to import the data</a></li>
<li class="chapter" data-level="2.4.7" data-path="getting-started.html"><a href="getting-started.html#step-7---look-inside-the-data"><i class="fa fa-check"></i><b>2.4.7</b> Step 7 - Look inside the data</a></li>
<li class="chapter" data-level="2.4.8" data-path="getting-started.html"><a href="getting-started.html#step-8---make-a-histogram"><i class="fa fa-check"></i><b>2.4.8</b> Step 8 - Make a histogram</a></li>
<li class="chapter" data-level="2.4.9" data-path="getting-started.html"><a href="getting-started.html#step-9---run-a-regression"><i class="fa fa-check"></i><b>2.4.9</b> Step 9 - Run a regression</a></li>
<li class="chapter" data-level="2.4.10" data-path="getting-started.html"><a href="getting-started.html#step-10---get-a-summary-of-your-results"><i class="fa fa-check"></i><b>2.4.10</b> Step 10 - Get a summary of your results</a></li>
<li class="chapter" data-level="2.4.11" data-path="getting-started.html"><a href="getting-started.html#a-look-forward"><i class="fa fa-check"></i><b>2.4.11</b> A Look forward</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic-r.html"><a href="basic-r.html"><i class="fa fa-check"></i><b>3</b> Basic R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="basic-r.html"><a href="basic-r.html#writing-in-r-and-rmarkdown"><i class="fa fa-check"></i><b>3.1</b> Writing in R and Rmarkdown</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="basic-r.html"><a href="basic-r.html#chatting-with-r"><i class="fa fa-check"></i><b>3.1.1</b> Chatting with R</a></li>
<li class="chapter" data-level="3.1.2" data-path="basic-r.html"><a href="basic-r.html#rmarkdown-tricks"><i class="fa fa-check"></i><b>3.1.2</b> Rmarkdown tricks</a></li>
<li class="chapter" data-level="3.1.3" data-path="basic-r.html"><a href="basic-r.html#code-blocks"><i class="fa fa-check"></i><b>3.1.3</b> Code blocks</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="basic-r.html"><a href="basic-r.html#variables"><i class="fa fa-check"></i><b>3.2</b> Variables</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="basic-r.html"><a href="basic-r.html#the-assignment-operator"><i class="fa fa-check"></i><b>3.2.1</b> The assignment operator</a></li>
<li class="chapter" data-level="3.2.2" data-path="basic-r.html"><a href="basic-r.html#numerics"><i class="fa fa-check"></i><b>3.2.2</b> Numerics</a></li>
<li class="chapter" data-level="3.2.3" data-path="basic-r.html"><a href="basic-r.html#characters"><i class="fa fa-check"></i><b>3.2.3</b> Characters</a></li>
<li class="chapter" data-level="3.2.4" data-path="basic-r.html"><a href="basic-r.html#booleans"><i class="fa fa-check"></i><b>3.2.4</b> Booleans</a></li>
<li class="chapter" data-level="3.2.5" data-path="basic-r.html"><a href="basic-r.html#special-types"><i class="fa fa-check"></i><b>3.2.5</b> Special types</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="basic-r.html"><a href="basic-r.html#vectors"><i class="fa fa-check"></i><b>3.3</b> Vectors</a></li>
<li class="chapter" data-level="3.4" data-path="basic-r.html"><a href="basic-r.html#lists"><i class="fa fa-check"></i><b>3.4</b> Lists</a></li>
<li class="chapter" data-level="3.5" data-path="basic-r.html"><a href="basic-r.html#dataframes"><i class="fa fa-check"></i><b>3.5</b> Dataframes</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="basic-r.html"><a href="basic-r.html#construction"><i class="fa fa-check"></i><b>3.5.1</b> Construction</a></li>
<li class="chapter" data-level="3.5.2" data-path="basic-r.html"><a href="basic-r.html#built-in-dataframes"><i class="fa fa-check"></i><b>3.5.2</b> Built-in dataframes</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="basic-r.html"><a href="basic-r.html#functions"><i class="fa fa-check"></i><b>3.6</b> Functions</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="basic-r.html"><a href="basic-r.html#getting-help"><i class="fa fa-check"></i><b>3.6.1</b> Getting help</a></li>
<li class="chapter" data-level="3.6.2" data-path="basic-r.html"><a href="basic-r.html#function-parameters"><i class="fa fa-check"></i><b>3.6.2</b> Function parameters</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="basic-r.html"><a href="basic-r.html#packages"><i class="fa fa-check"></i><b>3.7</b> Packages</a></li>
<li class="chapter" data-level="3.8" data-path="basic-r.html"><a href="basic-r.html#error-messages"><i class="fa fa-check"></i><b>3.8</b> Error messages</a></li>
<li class="chapter" data-level="3.9" data-path="basic-r.html"><a href="basic-r.html#coding-conventions"><i class="fa fa-check"></i><b>3.9</b> Coding Conventions</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="basic-r.html"><a href="basic-r.html#what-should-my-code-look-like"><i class="fa fa-check"></i><b>3.9.1</b> What should my code look like?</a></li>
<li class="chapter" data-level="3.9.2" data-path="basic-r.html"><a href="basic-r.html#official-coding-conventions"><i class="fa fa-check"></i><b>3.9.2</b> Official coding conventions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>4</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="logistic-regression.html"><a href="logistic-regression.html#steps-1-2---import-and-clean-data"><i class="fa fa-check"></i><b>4.1</b> Steps 1 &amp; 2 - Import and clean data</a></li>
<li class="chapter" data-level="4.2" data-path="logistic-regression.html"><a href="logistic-regression.html#steps-3-4---fit-the-model-and-summarize-it"><i class="fa fa-check"></i><b>4.2</b> Steps 3 &amp; 4 - Fit the model and summarize it</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="logistic-regression.html"><a href="logistic-regression.html#where-are-my-odds-ratios"><i class="fa fa-check"></i><b>4.2.1</b> Where are my odds ratios?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="logistic-regression.html"><a href="logistic-regression.html#plotting-predicted-values"><i class="fa fa-check"></i><b>4.3</b> Plotting predicted values</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An Organic R Textbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="logistic-regression" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Logistic Regression</h1>
<p>In this chapter, we’ll see the advantage of R’s linear regression-centric statistical analysis style (i.e., in which basically everything works the same way as a linear regression). Specifically, we’ll switch to a different form of statistical model, with different assumptions and observe that almost everything is the same.</p>
<p>This has the advantage that we need to relearn very little from model to model, and that we can feel more confident that we got our new model (in this case a logistic one) right on the first try.</p>
<div id="steps-1-2---import-and-clean-data" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Steps 1 &amp; 2 - Import and clean data</h2>
<p>To maximize comparability with the regression and hypotehsis testing chapters, we’ll again use the KSADS ABCD dataset. We can again import that dataset with our custom functions from earlier chapters.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="logistic-regression.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb138-2"><a href="logistic-regression.html#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="logistic-regression.html#cb138-3" aria-hidden="true" tabindex="-1"></a>read_abcd_quietly <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path){</span>
<span id="cb138-4"><a href="logistic-regression.html#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(</span>
<span id="cb138-5"><a href="logistic-regression.html#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">expr =</span> <span class="fu">read_delim</span>(file_path, <span class="at">delim =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-6"><a href="logistic-regression.html#cb138-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-7"><a href="logistic-regression.html#cb138-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">type_convert</span>())</span>
<span id="cb138-8"><a href="logistic-regression.html#cb138-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-9"><a href="logistic-regression.html#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="logistic-regression.html#cb138-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_abcd_quietly</span>(<span class="st">&#39;data/abcd_lpksad01.txt&#39;</span>)</span></code></pre></div>
<p>With the dataset loaded, we can now engage in some basic cleanup - the same as in previous chapters.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="logistic-regression.html#cb139-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="logistic-regression.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(src_subject_id) <span class="sc">%&gt;%</span> </span>
<span id="cb139-3"><a href="logistic-regression.html#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb139-4"><a href="logistic-regression.html#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> src_subject_id, </span>
<span id="cb139-5"><a href="logistic-regression.html#cb139-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> interview_age,</span>
<span id="cb139-6"><a href="logistic-regression.html#cb139-6" aria-hidden="true" tabindex="-1"></a>    sex, </span>
<span id="cb139-7"><a href="logistic-regression.html#cb139-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_hosp =</span> kbi_ss_c_mental_health_p_l,</span>
<span id="cb139-8"><a href="logistic-regression.html#cb139-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">grades =</span> kbi_p_grades_in_school_l) <span class="sc">%&gt;%</span> </span>
<span id="cb139-9"><a href="logistic-regression.html#cb139-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb139-10"><a href="logistic-regression.html#cb139-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb139-11"><a href="logistic-regression.html#cb139-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb139-12"><a href="logistic-regression.html#cb139-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">floor</span>(age <span class="sc">/</span> <span class="dv">12</span>),</span>
<span id="cb139-13"><a href="logistic-regression.html#cb139-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">factor</span>(sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;M&#39;</span>, <span class="st">&#39;F&#39;</span>)),</span>
<span id="cb139-14"><a href="logistic-regression.html#cb139-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">row_number</span>(),</span>
<span id="cb139-15"><a href="logistic-regression.html#cb139-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_timepoints =</span> <span class="fu">max</span>(time)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-16"><a href="logistic-regression.html#cb139-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb139-17"><a href="logistic-regression.html#cb139-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-18"><a href="logistic-regression.html#cb139-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(grades <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-19"><a href="logistic-regression.html#cb139-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, age, sex, grades, num_hosp)</span>
<span id="cb139-20"><a href="logistic-regression.html#cb139-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-21"><a href="logistic-regression.html#cb139-21" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 9,727 x 5
##    id                 age sex   grades num_hosp
##    &lt;chr&gt;            &lt;dbl&gt; &lt;fct&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 NDAR_INV9XU9GFCB     9 M          1        0
##  2 NDAR_INV029PWCFY     9 M          1        0
##  3 NDAR_INV06DE9Y0L     9 M          1        0
##  4 NDAR_INV0BL9EL2Y     9 F          1        0
##  5 NDAR_INV13BCLD41     9 M          2        0
##  6 NDAR_INV1APPZYY8     9 F          1        0
##  7 NDAR_INV2B9KMD5C     9 F          1        0
##  8 NDAR_INV2RYEWWRN     9 M          1        0
##  9 NDAR_INV3NT6ML17     9 F          1        0
## 10 NDAR_INV5FKNM21M     9 F          1        0
## # ... with 9,717 more rows</code></pre>
<p>One difference, though, is that we’ll need a dichotomous variable to analyze in our logistic regression. Here, we turn our <code>num_hosp</code> variable (i.e., the number of times a given patient has been hospitalized since last interview) into a dichotomous one, <code>ever_hosp</code> (i.e., has the patient been hospitalized at all since the past interview?).</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="logistic-regression.html#cb141-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="logistic-regression.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ever_hosp =</span> num_hosp <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="steps-3-4---fit-the-model-and-summarize-it" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Steps 3 &amp; 4 - Fit the model and summarize it</h2>
<p>To fit a logistic regression, we follow roughly the same steps as a linear one, with just a few changes.</p>
<p>First, we need to use <code>glm()</code> instead of the regular <code>lm()</code>. This is because we are fitting a “generalized linear model” (the family logistic regression belong to) instead of a traditional “general linear model.”</p>
<p>The second change is that we need to tell R which kind of GLM we want to fit (there are many). We do this by telling it what we think the outcome distribution is like (e.g., normal, binomial, etc). In this case, the family of distributions that logistic regressions use is the “binomial” one, so to get a logistic regression we simply feed the argument <code>'binomial'</code> to the <code>family</code> parameter.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="logistic-regression.html#cb142-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb142-2"><a href="logistic-regression.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> ever_hosp <span class="sc">~</span> sex <span class="sc">+</span> age,</span>
<span id="cb142-3"><a href="logistic-regression.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb142-4"><a href="logistic-regression.html#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span></code></pre></div>
<p>Once the model is fit, we can ask for a summary the same way that we would with a linear regression and we’ll see that the table we get is essentially the same.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="logistic-regression.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ever_hosp ~ sex + age, family = &quot;binomial&quot;, data = df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.1402  -0.0871  -0.0686  -0.0540   3.7269  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept) -10.8298     3.3850  -3.199  0.00138 **
## sexF         -0.8932     0.4792  -1.864  0.06234 . 
## age           0.4779     0.3146   1.519  0.12874   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 311.95  on 9719  degrees of freedom
## Residual deviance: 305.73  on 9717  degrees of freedom
##   (7 observations deleted due to missingness)
## AIC: 311.73
## 
## Number of Fisher Scoring iterations: 9</code></pre>
<div id="where-are-my-odds-ratios" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Where are my odds ratios?</h3>
<p>Most research scientists are used to thinking about logistic regression results in terms of odds ratios. Unfortunately, R won’t give you odds ratios by default. You need to compute them. Fortunately, it is really easy, once you remember that odds ratios are equal to:</p>
<p><span class="math display">\[
OR = e^b =  \exp(b)
\]</span></p>
<p>Thus, the quickest way to get them is to extract your coefficients from your fit object, then use <code>exp()</code> on them.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="logistic-regression.html#cb145-1" aria-hidden="true" tabindex="-1"></a>my_odds_ratios <span class="ot">&lt;-</span> fit <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="logistic-regression.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb145-3"><a href="logistic-regression.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb145-4"><a href="logistic-regression.html#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb145-5"><a href="logistic-regression.html#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="logistic-regression.html#cb145-6" aria-hidden="true" tabindex="-1"></a>my_odds_ratios</span></code></pre></div>
<pre><code>## (Intercept)        sexF         age 
##        0.00        0.41        1.61</code></pre>
<p>If you are in the process of creating a regression table, though, you might prefer to use <code>broom::tidy()</code> to get a dataframe of your <code>fit</code> object, then modify that with <code>mutate()</code>. This will make your results easier to export in .csv format.
If all you want are the numbers,</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="logistic-regression.html#cb147-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> fit <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="logistic-regression.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb147-3"><a href="logistic-regression.html#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">or =</span> <span class="fu">exp</span>(estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb147-4"><a href="logistic-regression.html#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">b =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb147-5"><a href="logistic-regression.html#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">3</span>)))</span>
<span id="cb147-6"><a href="logistic-regression.html#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="logistic-regression.html#cb147-7" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   term              b std.error statistic p.value    or
##   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 (Intercept) -10.8       3.38      -3.20   0.001 0    
## 2 sexF         -0.893     0.479     -1.86   0.062 0.409
## 3 age           0.478     0.315      1.52   0.129 1.61</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="logistic-regression.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(results, <span class="st">&#39;logistic_results.csv&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="plotting-predicted-values" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Plotting predicted values</h2>
<p>One question that has come up in the past is how to produce a plot of predicted values for a regression, including logistic ones.</p>
<p>This is possible by mixing tricks from <code>broom</code> and <code>ggplot</code> together, like so.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="logistic-regression.html#cb150-1" aria-hidden="true" tabindex="-1"></a>predicted_vals <span class="ot">&lt;-</span> fit <span class="sc">%&gt;%</span></span>
<span id="cb150-2"><a href="logistic-regression.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">augment</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb150-3"><a href="logistic-regression.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, age, <span class="at">log_odds =</span> .fitted) <span class="sc">%&gt;%</span> </span>
<span id="cb150-4"><a href="logistic-regression.html#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">odds =</span> <span class="fu">exp</span>(log_odds), <span class="at">p =</span> odds<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> odds)) <span class="sc">%&gt;%</span> </span>
<span id="cb150-5"><a href="logistic-regression.html#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() </span>
<span id="cb150-6"><a href="logistic-regression.html#cb150-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-7"><a href="logistic-regression.html#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predicted_vals, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> p, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb150-8"><a href="logistic-regression.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb150-9"><a href="logistic-regression.html#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basic-r.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "sepia",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/iancero/musc_r_course_2021/edit/main/logistic_regression.Rmd",
"text": "Find a typo? Please suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
